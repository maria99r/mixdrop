<app-navbar></app-navbar>

<button (click)="emparejar()">Jugar</button>

<div class="cabecera">
    <img [src]="IMG_URL + user?.avatarPath" alt="avatar de usuario">
    <span>{{user?.nickname}}</span> <!-- nickname del usuario-->
</div>

<!-- contenido -->
<div class="container">

    <!-- MENU LATERAL -->
    <aside>
        <div (click)=" menuSelector='myFriends'">
            <img src="/images/amigos.png" alt="icono amigo"> Tus amigos
        </div>
        <div (click)="menuSelector='searchUsers'">
            <img src="/images/buzon.png" alt="icono buzon"> Añadir a un amigo
        </div>
        <div (click)="menuSelector='friendRequest'">
            <img src="/images/invitacion.png" alt="icono carta"> Solicitudes de amistad
        </div>
        <div (click)="menuSelector='battleRequest'">
            <img src="/images/juego.png" alt="icono juego"> Solicitudes de batalla
        </div>
    </aside>


    <!-- CONTENIDO -->

    <section class="seccionAmigos">
        @switch (menuSelector) {

        <!-- LISTA DE AMIGOS-->
        @case ('myFriends') {

        <div class="busquedaUsuarios">
            <div>
                <span>TUS AMIGOS</span><br>
                <form (submit)="searchFriend(queryfriend)">
                    <input type="text" placeholder="Buscar amigos" class="icon-input" required [(ngModel)]="queryfriend"
                        [ngModelOptions]="{standalone: true}" />

                    <button type="submit" [disabled]="!queryfriend"> Buscar</button>
                </form>


                @if (acceptedFriends.length < 1) { <p> No tienes amigos :C</p> }

                    @else if (searchedFriends) {

                    @if (searchedFriends.length<1) { <p> Ninguno se llama asi :/</p> }
                        @else {

                        <p>CONECTADOS</p>

                        <div class="listaUsuarios">

                            @for (friend of searchedFriends; track $index)
                            {

                            @if (friend.senderUser?.stateId == 2 || friend.receiverUser?.stateId == 2) {

                            <div class="tarjetaConectado">
                                @if (friend.senderUser?.avatarPath != null && friend.senderUser?.avatarPath !=
                                undefined) {
                                <div class="contenedorAvatar">
                                    <img class="avatar" [src]="IMG_URL + friend.senderUser?.avatarPath"
                                        alt="usuario avatar" width="50px">
                                </div>
                                }
                                @if (friend.receiverUser?.avatarPath != null && friend.receiverUser?.avatarPath !=
                                undefined) {
                                <div class="contenedorAvatar">
                                    <img class="avatar" [src]="IMG_URL + friend.receiverUser?.avatarPath"
                                        alt="usuario avatar" width="50px">
                                </div>
                                }


                                <span class="nickname" (click)="visitUserPorfile(friend.receiverUser  || friend.senderUser)  ">
                                    {{ friend.senderUser?.nickname || friend.receiverUser?.nickname }}
                                </span>
                                <div class="contenedorIcono">
                                    <img class="icono" (click)="removeFriend(friend)" src="/images/deleteFriend.webp"
                                        alt="eliminar amigo">
                                </div>
                            </div>

                            }

                            }

                        </div>

                        <p>DESCONECTADOS</p>

                        <div class="listaUsuarios">

                            @for (friend of searchedFriends; track $index)
                            {

                            @if (friend.senderUser?.stateId == 1 || friend.receiverUser?.stateId == 1) {

                            <div class="tarjetaUsuario">
                                @if (friend.senderUser?.avatarPath != null && friend.senderUser?.avatarPath !=
                                undefined) {
                                <div class="contenedorAvatar">
                                    <img class="avatar" [src]="IMG_URL + friend.senderUser?.avatarPath"
                                        alt="usuario avatar" width="50px">
                                </div>
                                }
                                @if (friend.receiverUser?.avatarPath != null && friend.receiverUser?.avatarPath !=
                                undefined) {
                                <div class="contenedorAvatar">
                                    <img class="avatar" [src]="IMG_URL + friend.receiverUser?.avatarPath"
                                        alt="usuario avatar" width="50px">
                                </div>
                                }

                                <span class="nickname" (click)="visitUserPorfile(friend.receiverUser  || friend.senderUser)  ">
                                    {{ friend.senderUser?.nickname || friend.receiverUser?.nickname }}
                                </span>

                                <div class="contenedorIcono">
                                    <img class="icono" (click)="removeFriend(friend)" src="/images/deleteFriend.webp"
                                        alt="eliminar amigo">
                                </div>
                            </div>
                            }
                            }
                        </div>

                        <p>EN BATALLA</p>

                        <div class="listaUsuarios">

                            @for (friend of searchedFriends; track $index)
                            {

                            @if (friend.senderUser?.stateId == 3 || friend.receiverUser?.stateId == 3) {

                            <div class="tarjetaJugando">
                                @if (friend.senderUser?.avatarPath != null && friend.senderUser?.avatarPath !=
                                undefined) {
                                <div class="contenedorAvatar">
                                    <img class="avatar" [src]="IMG_URL + friend.senderUser?.avatarPath"
                                        alt="usuario avatar" width="50px">
                                </div>
                                }
                                @if (friend.receiverUser?.avatarPath != null && friend.receiverUser?.avatarPath !=
                                undefined) {
                                <div class="contenedorAvatar">
                                    <img class="avatar" [src]="IMG_URL + friend.receiverUser?.avatarPath"
                                        alt="usuario avatar" width="50px">
                                </div>
                                }


                                <span class="nickname" (click)="visitUserPorfile(friend.receiverUser  || friend.senderUser)  ">
                                    {{ friend.senderUser?.nickname || friend.receiverUser?.nickname }}
                                </span>

                                <div class="contenedorIcono">
                                    <img class="icono" (click)="removeFriend(friend)" src="/images/deleteFriend.webp"
                                        alt="eliminar amigo">
                                </div>
                            </div>
                            }
                            }
                        </div>


                        }
                        }
            </div>

        </div>
        }

        <!-- BUSCAR USUARIOS-->
        @case ('searchUsers') {
        <div class="busquedaUsuarios">
            <div>
                <span>BUSCAR USUARIO</span>
            </div>
            <form (submit)="getSearchedUsers(queryuser)">
                <input type="text" placeholder="Buscar usuarios" class="icon-input" required [(ngModel)]="queryuser"
                    [ngModelOptions]="{standalone: true}" />

                <button type="submit" [disabled]="!queryuser"> Buscar</button>
            </form>

            @if (searchedUsers) {

            @if (searchedUsers.length<1) { <p> No se encontraton usuarios</p> }
                @else {

                <div class="listaUsuarios">
                    @for (user of searchedUsers; track $index)
                    {
                    <div class="tarjetaUsuario">
                        <div class="contenedorAvatar">
                            <img class="avatar" [src]="IMG_URL + user?.avatarPath" alt="usuario avatar" width="50px">
                        </div>

                        <span (click)="visitUserPorfile(user )" class="nickname">{{user.nickname}}</span>

                        <div class="contenedorIcono">
                            @if (!hasFriendship(user)) { <img class="icono" (click)="addFriend(user)"
                                src="/images/addFriend.webp" alt="añadir amigo">
                            }
                        </div>


                    </div>
                    }
                </div>
                }
                }
        </div>
        }

        <!-- SOLICITUDES DE AMISTAD-->
        @case ('friendRequest') {
        SOLICITUDES DE AMISTAD

        @if (pendingFriends.length<1) { <p> No tienes solicitudes de amistad :C</p> }
            @else {

            <div class="listaUsuarios">
                @for (friend of pendingFriends; track $index)
                {
                <div class="tarjetaUsuario">
                    <div class="contenedorAvatar">
                        <img class="avatar" [src]="IMG_URL + friend.senderUser?.avatarPath" alt="usuario avatar"
                            width="50px">
                    </div>


                    <span class="nickname" (click)="visitUserPorfile(friend.receiverUser  || friend.senderUser)  ">
                        {{ friend.senderUser?.nickname || friend.receiverUser?.nickname }}
                    </span>
                    
                    <div class="contenedorIcono">
                        <img class="icono" (click)="acceptFriendship(friend.id)" src="/images/addFriend.webp"
                            alt="aceptar amigo">
                    </div>
                    <div class="contenedorIcono">
                        <img class="icono" (click)="removeFriend(friend)" src="/images/deleteFriend.webp"
                            alt="eliminar amigo">
                    </div>
                </div>
                }
            </div>
            }


            }

            <!-- SOLICITUDES DE BATALLA-->
            @case ('battleRequest') {
            SOLICITUDES DE BATALLA
            }
            }

    </section>


</div>

<div class="container">
    <p>Total de jugadores conectados: {{ totalPlayers }}</p>

    
</div>


<br><br><br><br>
<div>
    <button (click)="askForInfo(0)">Pedir dato 1</button>
    <button (click)="askForInfo(1)">Pedir dato 2</button>
    <button (click)="askForInfo(2)">Pedir dato 3</button>
    <p>{{ serverResponse }}</p>
    <p>Total de jugadores: {{ totalPlayers }}</p>
</div>